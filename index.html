<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#16213e">
    <meta name="description" content="Snoopy-Office åƒç´ é£æ ¼AIåŠ©æ‰‹çŠ¶æ€å¯è§†åŒ–Webåº”ç”¨">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Snoopy-Office åƒç´ åŠå…¬å®¤</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="frontend/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¢ Snoopy-Office åƒç´ åŠå…¬å®¤</h1>
            <div class="status-bar">
                <span id="time">ğŸ• --:--</span>
                <span id="connection">ğŸŸ¢ å·²è¿æ¥</span>
                <input type="text" id="search-box" placeholder="ğŸ” æœç´¢è§’è‰²..." oninput="searchCharacters(this.value)" title="æœç´¢è§’è‰² (/)">
                <button id="refresh-btn" class="sound-btn" onclick="refreshStatus()" title="åˆ·æ–°æ•°æ® (Space)">ğŸ”„</button>
                <button id="realtime-toggle" class="sound-btn" onclick="toggleRealTimeData()" title="åˆ‡æ¢å®æ—¶æ•°æ® (R)">ğŸ“¡</button>
                <button id="heatmap-toggle" class="sound-btn" onclick="toggleHeatmap()" title="åˆ‡æ¢çƒ­åŠ›å›¾ (H)">ğŸ—ºï¸</button>
                <button id="ranking-toggle" class="sound-btn" onclick="toggleRanking()" title="åˆ‡æ¢æ’åé¢æ¿ (L)">ğŸ†</button>
                <button id="theme-toggle" class="sound-btn" onclick="ThemeSystem.toggle()" title="åˆ‡æ¢ä¸»é¢˜ (T)">ğŸŒ™</button>
                <button id="time-toggle" class="sound-btn" onclick="TimeOfDaySystem.cycle()" title="åˆ‡æ¢æ—¶é—´ (M)">ğŸŒ…</button>
                <button id="weather-toggle" class="sound-btn" onclick="WeatherSystem.toggle()" title="åˆ‡æ¢å¤©æ°” (W)">â˜ï¸</button>
                <button id="skin-toggle" class="sound-btn" onclick="SkinSystem.cycle()" title="åˆ‡æ¢çš®è‚¤ (K)">ğŸ¨</button>
                <button id="sse-toggle" class="sound-btn" onclick="toggleSSE()" title="åˆ‡æ¢SSEæ¨é€ (S)">âš¡</button>
                <button id="music-toggle" class="sound-btn" onclick="BackgroundMusic.toggle()" title="èƒŒæ™¯éŸ³ä¹ (B)">ğŸ”‡</button>
                <button id="trend-toggle" class="sound-btn" onclick="DailyTrend.toggle()" title="ä»»åŠ¡è¶‹åŠ¿ (E)">ğŸ“Š</button>
                <button id="taskboard-toggle" class="sound-btn" onclick="TaskBoard.toggle()" title="ä»»åŠ¡çœ‹æ¿ (Tab)">ğŸ“‹</button>
                <button id="command-toggle" class="sound-btn" onclick="CommandPalette.toggle()" title="å¿«æ·å‘½ä»¤ (Ctrl+P)">âš¡</button>
                <button id="achievement-toggle" class="sound-btn" onclick="AchievementSystem.toggle()" title="æˆå°±ç³»ç»Ÿ (O)">ğŸ…</button>
                <button id="challenge-toggle" class="sound-btn" onclick="DailyChallengeSystem.toggle()" title="æ¯æ—¥æŒ‘æˆ˜ (J)">ğŸ¯</button>
                <button id="export-toggle" class="sound-btn" onclick="DataExportSystem.toggle()" title="æ•°æ®å¯¼å‡º (X)">ğŸ“¦</button>
                <button id="sound-toggle" class="sound-btn" onclick="toggleSound()">ğŸ”Š</button>
                <button class="sound-btn" onclick="toggleFullscreen()" title="å…¨å± (F)">ğŸ–¥ï¸</button>
                <button class="sound-btn" onclick="exportState()" title="å¯¼å‡ºçŠ¶æ€">ğŸ“¦</button>
                <label class="sound-btn" title="å¯¼å…¥çŠ¶æ€">ğŸ“¥
                    <input type="file" accept=".json" onchange="importState(this.files[0])" style="display:none">
                </label>
            </div>
        </header>
        
        <main>
            <canvas id="office" width="800" height="600"></canvas>
            
            <!-- ç»Ÿè®¡é¢æ¿ -->
            <div class="stats-panel">
                <div class="stat-row">
                    <span class="stat-label">å·¥ä½œä¸­:</span>
                    <span class="stat-value" id="stat-working">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">å¾…å‘½ä¸­:</span>
                    <span class="stat-value" id="stat-idle">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">æ€»è¿›åº¦:</span>
                    <span class="stat-value" id="stat-progress">0%</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">é€Ÿåº¦:</span>
                    <span class="stat-value" id="stat-speed">1.0x</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">ä»Šæ—¥å®Œæˆ:</span>
                    <span class="stat-value" id="stat-completed">0</span>
                </div>
                <div class="stat-row" id="zone-stats-row">
                    <span class="stat-label">çƒ­é—¨åŒºåŸŸ:</span>
                    <span class="stat-value" id="stat-top-zones">--</span>
                </div>
            </div>
            
            <!-- è§’è‰²è¯¦æƒ…é¢æ¿ -->
            <div id="character-panel" class="panel hidden">
                <div class="panel-header">
                    <h2 id="panel-name">è§’è‰²åç§°</h2>
                    <button class="close-btn" onclick="closePanel()">Ã—</button>
                </div>
                <div class="panel-content">
                    <div class="info-row">
                        <span class="label">å½“å‰çŠ¶æ€:</span>
                        <span id="panel-status" class="value">--</span>
                    </div>
                    <div class="info-row">
                        <span class="label">ä»»åŠ¡è¿›åº¦:</span>
                        <div class="progress-bar">
                            <div id="panel-progress" class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="info-row">
                        <span class="label">å½“å‰ä½ç½®:</span>
                        <span id="panel-location" class="value">--</span>
                    </div>
                    <div class="info-row">
                        <span class="label">ä»»åŠ¡æè¿°:</span>
                        <p id="panel-task">--</p>
                    </div>
                    <div class="info-row">
                        <span class="label">ä»»åŠ¡å†å²:</span>
                        <div id="panel-timeline" class="timeline"></div>
                    </div>
                </div>
            </div>
        </main>
        
        <footer>
            <div class="legend">
                <span>ğŸ‘” è€æ¿</span>
                <span>ğŸ¤– AIåŠ©æ‰‹</span>
                <span>ğŸ“‹ äº§å“</span>
                <span>ğŸ“Š é¡¹ç›®</span>
                <span>ğŸ’» å¼€å‘</span>
                <span>ğŸ§ª æµ‹è¯•</span>
                <span>ğŸ”’ å®‰å…¨</span>
                <span>ğŸ” çŸ¿å·¥</span>
                <span>âœï¸ åˆ›ä½œ</span>
            </div>
            <div class="shortcuts">
                <span>âŒ¨ï¸ å¿«æ·é”®: 1-8é€‰æ‹© | +/-é€Ÿåº¦ | Rå®æ—¶ | S-SSE | Hçƒ­åŠ›å›¾ | Læ’å | Tä¸»é¢˜ | Mæ—¶é—´ | Wå¤©æ°” | Kçš®è‚¤ | Eè¶‹åŠ¿ | BéŸ³ä¹ | Fè·Ÿéš | æ»šè½®ç¼©æ”¾ | ESCå…³é—­</span>
            </div>
        </footer>
    </div>
    
    <script src="frontend/game.js"></script>
    
    <!-- PWA Service Worker æ³¨å†Œ -->
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('SW registered:', registration.scope);
                })
                .catch(error => {
                    console.log('SW registration failed:', error);
                });
        });
    }
    
    // è¯·æ±‚é€šçŸ¥æƒé™
    function requestNotificationPermission() {
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission().then(permission => {
                console.log('Notification permission:', permission);
            });
        }
    }
    
    // è§¦æ‘¸è®¾å¤‡ä¸Šè‡ªåŠ¨è¯·æ±‚é€šçŸ¥æƒé™
    if ('ontouchstart' in window) {
        document.addEventListener('touchstart', function once() {
            requestNotificationPermission();
            document.removeEventListener('touchstart', once);
        }, { once: true });
    }
    
    // å‘é€é€šçŸ¥å‡½æ•°
    function sendNotification(title, body, icon = '/icon-192.png') {
        if ('Notification' in window && Notification.permission === 'granted') {
            new Notification(title, {
                body: body,
                icon: icon,
                badge: '/icon-192.png',
                tag: 'snoopy-office'
            });
        }
    }
    </script>
</body>
</html>
